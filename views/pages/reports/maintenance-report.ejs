<%- include('../../partials/header', { title: 'Laporan Maintenance Bulanan' }) %>

<div class="card shadow-sm">
    <div class="card-header bg-white py-3 border-bottom">
        <h5 class="mb-0 text-primary"><i class="bi bi-calendar-week-fill me-2"></i>Laporan Maintenance Bulanan</h5>
    </div>
    <div class="card-body p-4">
        <form action="/reports/maintenance" method="GET" class="row gx-3 gy-2 align-items-end mb-4 pb-3 border-bottom">
            <div class="col-md-4">
                <label for="month" class="form-label small fw-semibold">Pilih Bulan & Tahun</label>
                 <div class="input-group input-group-sm">
                     <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                    <input type="month" id="month" name="month" class="form-control" value="<%= selectedMonth %>" required>
                 </div>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary btn-sm w-100"><i class="bi bi-search me-1"></i> Tampilkan</button>
            </div>
        </form>

        <% if (logs !== null) { %>
            <h6 class="mb-3">Hasil Laporan: <span class="fw-bold text-primary"><%= new Date(selectedMonth + '-02').toLocaleDateString('id-ID', { month: 'long', year: 'numeric' }) %></span></h6>

            <% if (logs.length > 0) { %>
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-bordered table-sm small">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 15%;">Tanggal</th>
                                <th>Nama Aset/Host PC</th>
                                <th>Deskripsi Aktivitas</th>
                                <th style="width: 20%;">Teknisi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% logs.forEach(log => { %>
                                <tr>
                                    <td class="text-muted"><%= new Date(log.activity_date).toLocaleDateString('id-ID', {day:'2-digit', month:'short', year:'numeric'}) %></td>
                                    <td class="fw-medium">
                                        <% if (log.item) { %>
                                            <a href="/items/<%= log.itemId %>" title="Lihat Detail Aset"><%= log.item.host_pc_name || log.item.name %></a>
                                        <% } else { %>
                                            <span class="text-muted fst-italic">Aset Dihapus</span>
                                        <% } %>
                                    </td>
                                    <td><%= log.description %></td>
                                    <td class="text-muted"><%= log.technician_name || '-' %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="alert alert-warning text-center mt-3 small rounded-pill py-2">
                   <i class="bi bi-exclamation-triangle-fill me-1"></i> Tidak ada log maintenance pada bulan <%= new Date(selectedMonth + '-02').toLocaleDateString('id-ID', { month: 'long', year: 'numeric' }) %>.
                </div>
            <% } %>
        <% } else { %>
             <div class="alert alert-light text-center small rounded-pill py-2"> <i class="bi bi-info-circle me-1"></i> Pilih bulan dan tahun untuk menampilkan laporan.
             </div>
        <% } %>
    </div>
     <% if (logs && logs.length > 0) { %>
     <div class="card-footer bg-light text-muted small border-top py-2">
        Total: <%= logs.length %> log ditemukan.
     </div>
     <% } %>
</div>

<%- include('../../partials/footer') %>