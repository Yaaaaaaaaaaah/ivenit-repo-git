<%- include('../../partials/header', { title: `Detail Aset` }) %>

<%# --- JUDUL HALAMAN DAN TOMBOL AKSI --- %>
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h4 mb-1 fw-semibold text-primary"><%= item.name %></h1>
        <span class="small text-muted">Detail Aset</span>
    </div>
    <div>
        <% if (session && session.userId) { %>
            <a href="/items/<%= item.id %>/edit" class="btn btn-warning btn-sm rounded-pill"><i class="bi bi-pencil-square me-1"></i> Edit Aset</a>
        <% } %>
        <a href="/" class="btn btn-outline-secondary btn-sm rounded-pill ms-2"><i class="bi bi-arrow-left-circle me-1"></i>Kembali</a>
    </div>
</div>

<%# --- KONTEN UTAMA DENGAN TAB --- %>
<div class="row g-4">
    <%# --- KOLOM KIRI (HANYA Gambar) --- %>
    <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
            <div class="card-body p-3 text-center">
                
                <%
                let detailImagePath = '/images/placeholder.png'; // Default placeholder
                if (item.image_url) {
                    // Cek jika URL adalah URL Cloudinary (http) ATAU URL Lokal (/)
                    if (item.image_url.startsWith('http')) {
                        detailImagePath = item.image_url; // Gambar Cloudinary (Contoh: https://...)
                    } else if (item.image_url.startsWith('/')) {
                        detailImagePath = item.image_url; // Gambar Lokal (Contoh: /uploads/...)
                    }
                }
                %>
                <img src="<%= detailImagePath %>" 
                     alt="<%= item.name %>" 
                     class="img-fluid rounded-3 mb-3" 
                     style="max-height: 250px; width: auto; object-fit: contain;"
                     onerror="this.src='/images/placeholder.png'">
                <h5 class="mb-1"><%= item.name %></h5>
                <p class="text-muted small mb-3"><%= item.category ? item.category.name : 'Belum terkategori' %></p>
                
            </div>
        </div>
    </div>

    <%# --- KOLOM KANAN (Tab Konten) --- %>
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header p-0 border-bottom-0">
                <ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
                    
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="detail-tab" data-bs-toggle="tab" data-bs-target="#detail-tab-pane" type="button" role="tab" aria-controls="detail-tab-pane" aria-selected="true"><i class="bi bi-person-vcard me-2"></i>Detail Umum</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs-tab-pane" type="button" role="tab" aria-controls="specs-tab-pane" aria-selected="false"><i class="bi bi-cpu-fill me-2"></i>Spesifikasi</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="location-tab" data-bs-toggle="tab" data-bs-target="#location-tab-pane" type="button" role="tab" aria-controls="location-tab-pane" aria-selected="false"><i class="bi bi-geo-alt-fill me-2"></i>Lokasi & Info</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance-tab-pane" type="button" role="tab" aria-controls="maintenance-tab-pane" aria-selected="false"><i class="bi bi-tools me-2"></i>Riwayat Perawatan</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="loans-tab" data-bs-toggle="tab" data-bs-target="#loans-tab-pane" type="button" role="tab" aria-controls="loans-tab-pane" aria-selected="false"><i class="bi bi-person-lines-fill me-2"></i>Riwayat Pinjam</button>
                    </li>
                </ul>
            </div>
            <div class="card-body p-4">
                <div class="tab-content" id="myTabContent">
                    
                    <div class="tab-pane fade show active" id="detail-tab-pane" role="tabpanel" aria-labelledby="detail-tab" tabindex="0">
                        <h6 class="fw-semibold mb-3">Informasi Umum Aset</h6>
                        <ul class="list-group list-group-flush small">
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Status</span>
                                <span>
                                     <% if (item.availability_status === 'Tersedia') { %>
                                        <span class="badge text-bg-success rounded-pill fw-normal">Tersedia</span>
                                    <% } else if (item.availability_status === 'Dipinjam') { %>
                                        <span class="badge text-bg-warning rounded-pill fw-normal">Dipinjam</span>
                                    <% } else { %>
                                        <span class="badge text-bg-danger rounded-pill fw-normal"><%= item.availability_status %></span>
                                    <% } %>
                                </span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Kondisi</span>
                                <span><%= item.condition %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">PIC / Pengguna</span>
                                <span><%= item.pic_name %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Serial Number</span>
                                <span><%= item.serial_number || '-' %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">No. Inventaris</span>
                                <span><%= item.no_inventaris || '-' %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Model / Tipe</span>
                                <span><%= item.model || '-' %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Tanggal Beli</span>
                                <span><%= item.purchase_date ? new Date(item.purchase_date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) : '-' %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Umur Aset</span>
                                <span class="fw-medium"><%= item.umurAset %></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span class="fw-medium text-muted">Status Garansi</span>
                                <span>
                                    <span class="badge text-bg-<%= item.statusGaransiBadge %> rounded-pill fw-normal">
                                        <%= item.statusGaransi %>
                                    </span>
                                </span>
                            </li>
                        </ul>
                    </div>
                    
                    <%# Tab 2: Spesifikasi %>
                    <div class="tab-pane fade" id="specs-tab-pane" role="tabpanel" aria-labelledby="specs-tab" tabindex="0">
                        <h6 class="fw-semibold mb-3">Spesifikasi Teknis</h6>
                        <% if (item.specifications && item.specifications.length > 0) { %>
                            <dl class="row small mb-0">
                                <% item.specifications.forEach(spec => { %>
                                    <dt class="col-sm-4 col-md-3 text-muted"><%= spec.spec_key %></dt>
                                    <dd class="col-sm-8 col-md-9"><%= spec.spec_value %></dd>
                                <% }) %>
                            </dl>
                        <% } else { %>
                            <p class="text-muted fst-italic text-center m-0 small">Tidak ada data spesifikasi.</p>
                        <% } %>
                    </div>

                    <%# Tab 3: Lokasi & Info %>
                    <div class="tab-pane fade" id="location-tab-pane" role="tabpanel" aria-labelledby="location-tab" tabindex="0">
                        <h6 class="fw-semibold mb-3">Informasi Tambahan</h6>
                        <dl class="row small mb-0">
                            <dt class="col-sm-4 col-md-3 text-muted">Host PC Name</dt>
                            <dd class="col-sm-8 col-md-9"><%= item.host_pc_name || '-' %></dd>
                            
                            <dt class="col-sm-4 col-md-3 text-muted">Departemen</dt>
                            <dd class="col-sm-8 col-md-9"><%= item.department ? item.department.name : '-' %></dd>
                            
                            <dt class="col-sm-4 col-md-3 text-muted">Lokasi</dt>
                            <dd class="col-sm-8 col-md-9"><%= item.location ? item.location.name : '-' %></dd>
                            
                            <dt class="col-sm-4 col-md-3 text-muted">Catatan</dt>
                            <dd class="col-sm-8 col-md-9"><%= item.notes || '-' %></dd>
                        </dl>
                    </div>

                    <%# Tab 4: Riwayat Perawatan %>
                    <div class="tab-pane fade" id="maintenance-tab-pane" role="tabpanel" aria-labelledby="maintenance-tab" tabindex="0">
                         <h6 class="fw-semibold mb-3">Riwayat Perawatan</h6>
                         <ul class="list-group list-group-flush">
                            <% if (item.logs && item.logs.length > 0) { %>
                                <% item.logs.forEach(log => { %>
                                    <li class="list-group-item px-0">
                                        <div class="small">
                                            <div class="text-muted mb-1 d-flex justify-content-between">
                                                <span><i class="bi bi-calendar-event me-1"></i><%= new Date(log.activity_date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }) %></span>
                                                <span><i class="bi bi-person-fill me-1"></i><%= log.technician_name || 'N/A' %></span>
                                            </div>
                                            <%= log.description %>
                                        </div>
                                    </li>
                                <% }) %>
                            <% } else { %>
                                <li class="list-group-item text-center text-muted fst-italic px-0 py-3 small">Belum ada riwayat perawatan.</li>
                            <% } %>
                        </ul>
                    </div>

                    <%# Tab 5: Riwayat Peminjaman (Kosong dulu) %>
                    <div class="tab-pane fade" id="loans-tab-pane" role="tabpanel" aria-labelledby="loans-tab" tabindex="0">
                         <h6 class="fw-semibold mb-3">Riwayat Peminjaman</h6>
                         <p class="text-muted fst-italic text-center m-0">(Fitur ini akan menampilkan riwayat peminjaman aset)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../../partials/footer') %>