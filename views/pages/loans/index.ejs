<%- include('../../partials/header', { title: 'Manajemen Peminjaman Aset' }) %>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary-subtle text-primary py-2"> <h6 class="mb-0 fw-semibold"><i class="bi bi-journal-plus me-2"></i>Catat Peminjaman Baru</h6>
    </div>
    <div class="card-body p-4">
        <form action="/loans" method="POST">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="itemId" class="form-label small">Aset Tersedia <span class="text-danger">*</span></label>
                    <select name="itemId" id="itemId" class="form-select form-select-sm" required>
                        <option value="">-- Pilih Aset --</option>
                        <% availableItems.forEach(item => { %>
                            <option value="<%= item.id %>"><%= item.host_pc_name || item.name %></option>
                        <% }) %>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="borrower_name" class="form-label small">Nama Peminjam <span class="text-danger">*</span></label>
                    <input type="text" name="borrower_name" id="borrower_name" class="form-control form-control-sm" required>
                </div>
                <div class="col-md-2">
                    <label for="loan_date" class="form-label small">Tgl. Pinjam <span class="text-danger">*</span></label>
                    <input type="date" name="loan_date" id="loan_date" class="form-control form-control-sm" value="<%= new Date().toISOString().split('T')[0] %>" required>
                </div>
                 <div class="col-md-3">
                     <label for="notes" class="form-label small">Catatan</label>
                     <input type="text" name="notes" id="notes" class="form-control form-control-sm">
                 </div>
                <div class="col-12 mt-3 text-end">
                    <button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-check-circle me-1"></i>Simpan Peminjaman</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header bg-white py-3 border-bottom">
        <h5 class="mb-0 text-primary"><i class="bi bi-list-task me-2"></i>Riwayat Peminjaman</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0 align-middle small">
                <thead class="table-light">
                    <tr>
                        <th class="ps-3">Nama Aset</th>
                        <th>Peminjam</th>
                        <th>Tgl Pinjam</th>
                        <th>Tgl Kembali</th>
                        <th>Status</th>
                        <th class="text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (loans && loans.length > 0) { %>
                        <% loans.forEach(loan => { %>
                            <tr>
                                <td class="ps-3 fw-medium"><%= loan.item ? (loan.item.host_pc_name || loan.item.name) : 'Aset Dihapus' %></td>
                                <td><%= loan.borrower_name %></td>
                                <td><%= new Date(loan.loan_date).toLocaleDateString('id-ID', {day:'2-digit', month:'short', year:'numeric'}) %></td>
                                <td><%= loan.return_date ? new Date(loan.return_date).toLocaleDateString('id-ID', {day:'2-digit', month:'short', year:'numeric'}) : '-' %></td>
                                <td>
                                    <% if (loan.status === 'Dipinjam') { %>
                                        <span class="badge text-bg-warning rounded-pill fw-normal">Dipinjam</span>
                                    <% } else { %>
                                        <span class="badge text-bg-success rounded-pill fw-normal">Kembali</span>
                                    <% } %>
                                </td>
                                <td class="text-center">
                                    <% if (loan.status === 'Dipinjam') { %>
                                        <form action="/loans/<%= loan.id %>/return" method="POST" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-success rounded-pill" title="Tandai Sudah Kembali"><i class="bi bi-check2-circle me-1"></i> Kembali</button>
                                        </form>
                                    <% } else { %>
                                        <span class="text-muted">-</span>
                                    <% } %>
                                </td>
                            </tr>
                        <% }) %>
                     <% } else { %>
                        <tr><td colspan="6" class="text-center text-muted py-4 fst-italic">Belum ada riwayat peminjaman.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
     <% if (loans && loans.length > 0) { %>
     <div class="card-footer bg-light text-muted small border-top py-2">
        Total: <%= loans.length %> transaksi.
     </div>
     <% } %>
</div>

<%- include('../../partials/footer') %>